from .loader import HousingDataset as HD

import matplotlib.pyplot as plt
from numpy.polynomial.polynomial import polyfit
import numpy as np

def correlation_matrix(data):
    corr = data.corr()
    plt.matshow(corr)
    plt.xticks(range(len(corr.columns)), corr.columns, rotation='vertical')
    plt.yticks(range(len(corr.columns)), corr.columns)
    plt.colorbar()
    plt.title("Correlation Matrix For 15-0000")
    plt.show()

def scatter(data, cols=["A_MEAN", "HOUSING_INDEX"]):
    assert len(cols) == 2

    data = data.dropna(subset=cols)
    xlab = cols[0]
    ylab = cols[1]
    b, m = line = polyfit(data[xlab], data[ylab], 1)
    plt.scatter(data[xlab], data[ylab])
    plt.plot(data[xlab], b + m * data[xlab], '-')
    plt.xlabel(xlab)
    plt.ylabel(ylab)
    plt.title(f"Scatter for {xlab} vs {ylab}")
    plt.show()

def run_long_correlation():
    arr = ["00-0000", "11-0000", "11-1011", "11-1021", "11-1031", "11-2011", "11-2021", "11-2022", "11-2031", "11-3011", "11-3021", "11-3031", "11-3041", "11-3042", "11-3051", "11-3061", "11-3071", "11-9021", "11-9031", "11-9032", "11-9033", "11-9041", "11-9051", "11-9081", "11-9111", "11-9121", "11-9141", "11-9151", "11-9199", "13-0000", "13-1022", "13-1023", "13-1031", "13-1051", "13-1071", "13-1072", "13-1073", "13-1079", "13-1081", "13-1111", "13-1121", "13-1199", "13-2011", "13-2021", "13-2041", "13-2051", "13-2072", "13-2082", "15-0000", "15-1021", "15-1031", "15-1032", "15-1041", "15-1051", "15-1061", "15-1071", "15-1081", "15-1099", "17-0000", "17-1021", "17-1022", "17-2051", "17-2061", "17-2071", "17-2072", "17-2111", "17-2112", "17-2141", "17-3011", "17-3013", "17-3022", "17-3026", "17-3027", "17-3029", "17-3031", "19-0000", "19-1013", "19-2031", "19-2041", "19-3021", "19-3022", "19-3031", "19-3051", "19-4021", "19-4031", "19-4091", "19-4093", "21-0000", "21-1011", "21-1012", "21-1014", "21-1021", "21-1023", "21-1093", "21-1099", "23-0000", "23-1011", "23-2011", "23-2092", "23-2093", "25-0000", "25-1081", "25-1121", "25-1194", "25-2011", "25-2012", "25-2021", "25-2022", "25-2031", "25-2032", "25-2041", "25-2043", "25-3021", "25-3099", "25-4021", "25-4031", "25-9031", "25-9041", "25-9099", "27-0000", "27-1014", "27-1023", "27-1024", "27-1025", "27-1026", "27-2012", "27-2022", "27-2023", "27-3031", "27-3041", "27-3042", "27-3043", "27-3099", "27-4021", "29-0000", "29-1011", "29-1021", "29-1031", "29-1051", "29-1062", "29-1064", "29-1067", "29-1071", "29-1111", "29-1122", "29-1123", "29-1125", "29-1127", "29-1131", "29-2021", "29-2032", "29-2034", "29-2041", "29-2051", "29-2052", "29-2056", "29-2061", "29-2081", "29-9011", "31-0000", "31-1011", "31-1012", "31-2021", "31-2022", "31-9091", "31-9092", "31-9095", "31-9096", "33-0000", "33-1021", "33-2011", "33-3021", "33-3051", "33-9032", "33-9091", "33-9092", "33-9099", "35-0000", "35-1011", "35-1012", "35-2011", "35-2012", "35-2014", "35-2015", "35-2021", "35-3011", "35-3021", "35-3022", "35-3031", "35-3041", "35-9011", "35-9021", "35-9031", "35-9099", "37-0000", "37-1011", "37-1012", "37-2011", "37-2012", "37-2021", "37-3011", "39-0000", "39-1021", "39-3021", "39-3031", "39-3091", "39-4021", "39-5012", "39-9011", "39-9021", "39-9031", "39-9032", "39-9041", "39-9099", "41-0000", "41-1011", "41-1012", "41-2011", "41-2021", "41-2022", "41-2031", "41-3021", "41-3031", "41-3041", "41-3099", "41-4011", "41-4012", "41-9011", "41-9021", "41-9022", "41-9031", "41-9041", "41-9099", "43-0000", "43-1011", "43-2011", "43-3011", "43-3021", "43-3031", "43-3051", "43-3071", "43-4031", "43-4041", "43-4051", "43-4071", "43-4081", "43-4111", "43-4121", "43-4131", "43-4141", "43-4151", "43-4161", "43-4171", "43-4199", "43-5021", "43-5031", "43-5032", "43-5041", "43-5051", "43-5052", "43-5053", "43-5061", "43-5071", "43-5081", "43-5111", "43-6011", "43-6012", "43-6013", "43-6014", "43-9011", "43-9021", "43-9022", "43-9031", "43-9041", "43-9051", "43-9061", "43-9081", "43-9199", "45-0000", "45-2093", "47-0000", "47-1011", "47-2011", "47-2021", "47-2031", "47-2044", "47-2051", "47-2061", "47-2073", "47-2081", "47-2082", "47-2111", "47-2141", "47-2151", "47-2152", "47-2161", "47-2171", "47-2181", "47-2211", "47-2221", "47-3011", "47-3012", "47-3013", "47-3014", "47-3015", "47-3019", "47-4011", "47-4051", "49-0000", "49-1011", "49-2011", "49-2094", "49-2098", "49-3021", "49-3023", "49-3031", "49-3042", "49-3092", "49-9021", "49-9041", "49-9042", "49-9043", "49-9052", "49-9062", "49-9094", "49-9098", "49-9099", "51-0000", "51-1011", "51-2021", "51-2022", "51-2041", "51-2092", "51-2099", "51-3011", "51-3021", "51-3023", "51-3092", "51-4011", "51-4031", "51-4033", "51-4041", "51-4071", "51-4072", "51-4081", "51-4111", "51-4121", "51-4122", "51-4191", "51-5011", "51-5012", "51-5021", "51-5022", "51-5023", "51-6011", "51-6021", "51-6031", "51-6099", "51-7011", "51-7021", "51-7041", "51-7042", "51-8031", "51-9021", "51-9022", "51-9023", "51-9032", "51-9041", "51-9061", "51-9081", "51-9111", "51-9121", "51-9122", "51-9131", "51-9132", "51-9198", "53-0000", "53-1021", "53-1031", "53-3022", "53-3031", "53-3032", "53-3033", "53-3041", "53-7032", "53-7051", "53-7061", "53-7062", "53-7064", "53-7081", "53-7199"]
    hd = HD(arr)
    corr, top = long_correlation(hd.data)
    return hd, corr, top

def long_correlation(data):
    corr = data.corr()
    hi = corr["HOUSING_INDEX"]
    top = hi.sort_values(ascending=False)[1:20]
    l = np.array(top).reshape((1, -1))
    plt.matshow(l)
    plt.colorbar()
    plt.show()
    return corr, top
    
if __name__ == "__main__":
    dataset = HD(["15-0000"])
    correlation_matrix(dataset.data)
